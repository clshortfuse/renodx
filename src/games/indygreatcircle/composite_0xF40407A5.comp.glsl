#version 460
#extension GL_EXT_buffer_reference2 : require
#extension GL_EXT_nonuniform_qualifier : require
#if defined(GL_EXT_control_flow_attributes)
#extension GL_EXT_control_flow_attributes : require
#define SPIRV_CROSS_FLATTEN [[flatten]]
#define SPIRV_CROSS_BRANCH  [[dont_flatten]]
#define SPIRV_CROSS_UNROLL  [[unroll]]
#define SPIRV_CROSS_LOOP    [[dont_unroll]]
#else
#define SPIRV_CROSS_FLATTEN
#define SPIRV_CROSS_BRANCH
#define SPIRV_CROSS_UNROLL
#define SPIRV_CROSS_LOOP
#endif

#extension GL_GOOGLE_include_directive : require
#include "./include/common.glsl"
#include "./include/filmgrain.glsl"
#include "./shared.h"

layout(local_size_x = 8, local_size_y = 8, local_size_z = 1) in;

struct _2270 {
  float _m0;
  float _m1;
};

struct _2271 {
  float _m0[6];
  float _m1[6];
  _2270 _m2;
  _2270 _m3;
  _2270 _m4;
  float _m5;
  float _m6;
};

layout(buffer_reference) buffer _377;
layout(buffer_reference, buffer_reference_align = 16, std430) buffer _377 {
  uvec4 _m0;
  vec4 _m1;
  vec4 _m2;
  vec4 _m3;
  vec4 _m4;
  vec4 _m5;
  vec4 _m6;
  vec4 _m7;
  vec4 _m8;
  uint _m9;
  uint _m10;
  float _m11;
  float _m12;
  float _m13;
  float _m14;
  float _m15;
  float _m16;
  float _m17;
  uint _m18;
};

layout(set = 0, binding = 0, std140) uniform _688_690 {
  uvec4 _m0;
  vec4 _m1;
  vec4 _m2;
  vec4 _m3;
  vec4 _m4;
  vec4 _m5;
  vec4 _m6;
  vec4 _m7;
  vec4 _m8;
  vec4 _m9;
  vec4 _m10;
  uint _m11;
  float _m12;
  float _m13;
  float _m14;
  float _m15;
  float _m16;
  float _m17;
  float _m18;
  float _m19;
  float _m20;
  float _m21;
  float _m22;
  float _m23;
  float _m24;
  float _m25;
  float _m26;
  float _m27;
  float _m28;
  float _m29;
  float _m30;
  float _m31;
  float _m32;
  float _m33;
  float _m34;
  float _m35;
  float _m36;
  float _m37;
  float _m38;
  float _m39;
  float _m40;
  uint _m41;
  uint _m42;
  uint _m43;
  float _m44;
  uint _m45;
  uint _m46;
  int _m47;
  float _m48;
  uint _m49;
}
_690;

layout(set = 0, binding = 1, std140) uniform _2172_2174 {
  vec4 _m0[1024];
}
_2174;

layout(set = 0, binding = 2, std430) restrict readonly buffer _2176_2178 {
  uvec4 _m0[];
}
_2178;

layout(set = 0, binding = 3, std430) restrict readonly buffer _2180_2182 {
  uvec4 _m0[];
}
_2182;

layout(push_constant, std430) uniform _374_379 {
  _377 _m0;
}
_379;

layout(set = 1, binding = 1) uniform texture2D _430;
layout(set = 0, binding = 6) uniform sampler _434;
layout(set = 0, binding = 7) uniform sampler _573;
layout(set = 1, binding = 2) uniform texture2D _1084;
layout(set = 0, binding = 8) uniform sampler _1086;
layout(set = 0, binding = 9) uniform texture2D _1207;
layout(set = 0, binding = 4) uniform sampler _1209;
layout(set = 1, binding = 3, rgba8) uniform writeonly image2D _1466;
layout(set = 1, binding = 4, rgb10_a2) uniform writeonly image2D _2126;
layout(set = 1, binding = 5, r11f_g11f_b10f) uniform writeonly image2D _2141;
layout(set = 2, binding = 0) uniform texture2D _2161[];
layout(set = 2, binding = 1) uniform textureCube _2165[1];
layout(set = 2, binding = 2) uniform texture3D _2169[1];
layout(set = 0, binding = 5) uniform texture2D _2183;

uint _97;
uint _99;
uint _2190;

float _66(float _65) {
  return 0.16666667163372039794921875 * ((_65 * ((_65 * ((-_65) + 3.0)) - 3.0)) + 1.0);
}

float _69(float _68) {
  return 0.16666667163372039794921875 * (((_68 * _68) * ((3.0 * _68) - 6.0)) + 4.0);
}

float _78(float _77) {
  float _276 = _77;
  float _279 = _77;
  return _66(_276) + _69(_279);
}

float _72(float _71) {
  return 0.16666667163372039794921875 * ((_71 * ((_71 * (((-3.0) * _71) + 3.0)) + 3.0)) + 1.0);
}

float _75(float _74) {
  return 0.16666667163372039794921875 * ((_74 * _74) * _74);
}

float _81(float _80) {
  float _285 = _80;
  float _288 = _80;
  return _72(_285) + _75(_288);
}

float _84(float _83) {
  float _295 = _83;
  float _298 = _83;
  float _301 = _83;
  return (-1.0) + (_69(_295) / (_66(_298) + _69(_301)));
}

float _87(float _86) {
  float _309 = _86;
  float _312 = _86;
  float _315 = _86;
  return 1.0 + (_75(_309) / (_72(_312) + _75(_315)));
}

vec2 _16(vec2 _15) {
  return clamp(_15, vec2(0.0), vec2(1.0));
}

vec3 _46(vec3 _44, mat3 _45) {
  return _44 * _45;
}

vec3 _59(vec3 _55, mat3 _56, mat3 _57, mat3 _58) {
  vec3 _209 = _55;
  mat3 _210 = _56;
  vec3 _212 = _46(_209, _210);
  mat3 _213 = _57;
  vec3 _215 = _46(_212, _213);
  mat3 _216 = _58;
  return _46(_215, _216);
}

vec3 _22(vec3 _21) {
  return clamp(_21, vec3(0.0), vec3(1.0));
}

float _25(float _24) {
  float _123;
  if (_24 <= 0.040449999272823333740234375) {
    _123 = _24 / 12.9200000762939453125;
  } else {
    _123 = pow((_24 / 1.05499994754791259765625) + 0.0521326996386051177978515625, 2.400000095367431640625);
  }
  return _123;
}

vec3 _28(vec3 _27) {
  float _140 = _27.x;
  float _145 = _27.y;
  float _150 = _27.z;
  return vec3(_25(_140), _25(_145), _25(_150));
}

vec3 _41(mat3 _39, vec3 _40) {
  return _39 * _40;
}

float _31(float _30) {
  float _161;
  if (_30 > 0.003130800090730190277099609375) {
    _161 = (pow(_30, 0.4166666567325592041015625) * 1.05499994754791259765625) - 0.054999999701976776123046875;
  } else {
    _161 = _30 * 12.9200000762939453125;
  }
  return _161;
}

vec3 _34(vec3 _33) {
  float _176 = _33.x;
  float _180 = _33.y;
  float _184 = _33.z;
  return vec3(_31(_176), _31(_180), _31(_184));
}

float _63(vec3 _62) {
  return dot(_62, vec3(0.2125999927520751953125, 0.715200006961822509765625, 0.072200000286102294921875));
}

float _10(float _9) {
  return clamp(_9, 0.0, 1.0);
}

vec3 _52(vec3 _49, mat3 _50, mat3 _51) {
  vec3 _201 = _49;
  mat3 _202 = _50;
  vec3 _204 = _46(_201, _202);
  mat3 _205 = _51;
  return _46(_204, _205);
}

float _90(float _89) {
  float _323 = _89 / 10000.0;
  float _327 = pow(_323, 0.1593017578125);
  float _331 = (0.8359375 + (18.8515625 * _327)) / (1.0 + (18.6875 * _327));
  _331 = pow(_331, 78.84375);
  return _331;
}

vec3 _93(vec3 _92) {
  float _348 = _92.x;
  float _352 = _92.y;
  float _356 = _92.z;
  return vec3(_90(_348), _90(_352), _90(_356));
}

void main() {
  _97 = 2147483648u;
  _99 = 1073741824u;
  ivec3 _366 = ivec3(gl_GlobalInvocationID);
  vec2 _372 = _379._m0._m1.xy + (_379._m0._m1.zw * (vec2(_366.xy) + vec2(0.5)));
  vec2 _403 = _379._m0._m2.zw * (vec2(_366.xy) + vec2(0.5));
  vec2 _416 = _372;
  vec3 _427;
  SPIRV_CROSS_BRANCH
  if (_379._m0._m3.x < 0.0) {
    _427 = textureLod(sampler2D(_430, _434), vec4(_416, 0.0, 0.0).xy, vec4(_416, 0.0, 0.0).w).xyz;
  } else {
    vec2 _452 = (_416 * _379._m0._m3.xy) + vec2(0.5);
    vec2 _462 = floor(_452);
    vec2 _465 = fract(_452);
    float _469 = _465.x;
    float _468 = _78(_469);
    float _474 = _465.x;
    float _473 = _81(_474);
    float _479 = _465.x;
    float _478 = _84(_479);
    float _484 = _465.x;
    float _483 = _87(_484);
    float _489 = _465.y;
    float _488 = _84(_489);
    float _494 = _465.y;
    float _493 = _87(_494);
    vec2 _498 = (vec2(_462.x + _478, _462.y + _488) - vec2(0.5)) / _379._m0._m3.xy;
    vec2 _516 = (vec2(_462.x + _483, _462.y + _488) - vec2(0.5)) / _379._m0._m3.xy;
    vec2 _534 = (vec2(_462.x + _478, _462.y + _493) - vec2(0.5)) / _379._m0._m3.xy;
    vec2 _552 = (vec2(_462.x + _483, _462.y + _493) - vec2(0.5)) / _379._m0._m3.xy;
    vec4 _571 = textureLod(sampler2D(_430, _573), vec4(_498, 0.0, 0.0).xy, vec4(_498, 0.0, 0.0).w);
    vec4 _587 = textureLod(sampler2D(_430, _573), vec4(_516, 0.0, 0.0).xy, vec4(_516, 0.0, 0.0).w);
    vec4 _602 = textureLod(sampler2D(_430, _573), vec4(_534, 0.0, 0.0).xy, vec4(_534, 0.0, 0.0).w);
    vec4 _617 = textureLod(sampler2D(_430, _573), vec4(_552, 0.0, 0.0).xy, vec4(_552, 0.0, 0.0).w);
    float _633 = _465.y;
    float _645 = _465.y;
    vec4 _632 = (((_571 * _468) + (_587 * _473)) * _78(_633)) + (((_602 * _468) + (_617 * _473)) * _81(_645));
    _427 = mix(_632.xyz, textureLod(sampler2D(_430, _573), vec4(_416, 0.0, 0.0).xy, vec4(_416, 0.0, 0.0).w).xyz, _379._m0._m4.zzz);
    _427 = max(vec3(0.0), _427);
  }
  bool _686 = false;
  SPIRV_CROSS_BRANCH
  if (_690._m47 > 0) {
    vec2 _698 = (_372 - _690._m8.xy) * _690._m8.zw;
    vec2 _711 = _698;
    if (all(equal(_698, _16(_711)))) {
      _686 = true;
    }
    _698 = (_372 - _690._m9.xy) * _690._m9.zw;
    bool _732 = _690._m47 > 1;
    bool _741;
    if (_732) {
      vec2 _736 = _698;
      _741 = all(equal(_698, _16(_736)));
    } else {
      _741 = _732;
    }
    if (_741) {
      _686 = true;
    }
    _698 = (_372 - _690._m10.xy) * _690._m10.zw;
    bool _756 = _690._m47 > 2;
    bool _765;
    if (_756) {
      vec2 _760 = _698;
      _765 = all(equal(_698, _16(_760)));
    } else {
      _765 = _756;
    }
    if (_765) {
      _686 = true;
    }
  }
  uint _769 = _379._m0._m10;
  vec4 _1119;
  SPIRV_CROSS_BRANCH
  if ((_769 & 1u) == 0u) {
    SPIRV_CROSS_BRANCH
    if ((_769 & 4u) != 0u) {
      _427 = max(vec3(0.0), _427);
      _427 /= vec3(_379._m0._m11);  // UI Brightness
      _427 = _59(_427, mat3(vec3(0.63695812225341796875, 0.14461691677570343017578125, 0.168880939483642578125), vec3(0.2627002298831939697265625, 0.677998065948486328125, 0.059301711618900299072265625), vec3(0.0, 0.02807269059121608734130859375, 1.0609848499298095703125)), mat3(vec3(0.987228810787200927734375, -0.00611330009996891021728515625, 0.0159534104168415069580078125), vec3(-0.007598400115966796875, 1.00185978412628173828125, 0.0053300000727176666259765625), vec3(0.00307258008979260921478271484375, -0.0050959200598299503326416015625, 1.0816795825958251953125)), mat3(vec3(3.2409694194793701171875, -1.53738296031951904296875, -0.4986107647418975830078125), vec3(-0.96924388408660888671875, 1.87596786022186279296875, 0.041555099189281463623046875), vec3(0.055630020797252655029296875, -0.2039768397808074951171875, 1.0569713115692138671875)));
    } else {
      vec3 _837 = _427;
      vec3 _840 = _22(_837);
      _427 = _28(_840);
    }
    vec3 _842 = _427;
    SPIRV_CROSS_BRANCH
    if (_379._m0._m4.x > 0.0) {
      float _851 = _379._m0._m12;
      float _857 = _379._m0._m13;
      float _863 = mix(0.75, 1.5, _379._m0._m14);
      float _872 = mix(0.0, 1.0, _379._m0._m15);
      _842 = ((_842 - vec3(0.5)) * vec3(_863)) + vec3(_872);
      vec3 _888 = vec3(0.0);
      vec3 _914;
      vec3 _927;
      SPIRV_CROSS_BRANCH
      if (_379._m0._m4.x == 1.0) {
        mat3 _910 = mat3(vec3(0.3139902055263519287109375, 0.1553724110126495361328125, 0.0177523903548717498779296875), vec3(0.639512956142425537109375, 0.757894456386566162109375, 0.109442092478275299072265625), vec3(0.0464975498616695404052734375, 0.0867014229297637939453125, 0.87256920337677001953125));
        vec3 _911 = _842;
        vec3 _896 = _41(_910, _911);
        _914.x = dot(_896, vec3(0.0, 1.0511829853057861328125, -0.051160991191864013671875));
        _914.y = _896.y;
        _914.z = _896.z;
        mat3 _941 = mat3(vec3(5.4722118377685546875, -1.12524187564849853515625, 0.02980164997279644012451171875), vec3(-4.64196014404296875, 2.293170928955078125, -0.19318072497844696044921875), vec3(0.16963708400726318359375, -0.16789519786834716796875, 1.1636478900909423828125));
        vec3 _942 = _914;
        _927 = _41(_941, _942);
        vec3 _945 = _842 - _927;
        _888.x = 0.0;
        _888.y = (_945.x * _851) + _945.y;
        _888.z = (_945.x * _851) + _945.z;
      } else {
        SPIRV_CROSS_BRANCH
        if (_379._m0._m4.x == 2.0) {
          mat3 _976 = mat3(vec3(0.3139902055263519287109375, 0.1553724110126495361328125, 0.0177523903548717498779296875), vec3(0.639512956142425537109375, 0.757894456386566162109375, 0.109442092478275299072265625), vec3(0.0464975498616695404052734375, 0.0867014229297637939453125, 0.87256920337677001953125));
          vec3 _977 = _842;
          vec3 _975 = _41(_976, _977);
          _914.x = _975.x;
          _914.y = dot(_975, vec3(0.9513092041015625, 0.0, 0.04866991937160491943359375));
          _914.z = _975.z;
          mat3 _992 = mat3(vec3(5.4722118377685546875, -1.12524187564849853515625, 0.02980164997279644012451171875), vec3(-4.64196014404296875, 2.293170928955078125, -0.19318072497844696044921875), vec3(0.16963708400726318359375, -0.16789519786834716796875, 1.1636478900909423828125));
          vec3 _993 = _914;
          _927 = _41(_992, _993);
          vec3 _996 = _842 - _927;
          _888.x = (_996.y * _851) + _996.x;
          _888.y = 0.0;
          _888.z = (_996.y * _851) + _996.z;
        } else {
          SPIRV_CROSS_BRANCH
          if (_379._m0._m4.x == 3.0) {
            mat3 _1026 = mat3(vec3(0.3139902055263519287109375, 0.1553724110126495361328125, 0.0177523903548717498779296875), vec3(0.639512956142425537109375, 0.757894456386566162109375, 0.109442092478275299072265625), vec3(0.0464975498616695404052734375, 0.0867014229297637939453125, 0.87256920337677001953125));
            vec3 _1027 = _842;
            vec3 _1025 = _41(_1026, _1027);
            _914.x = _1025.x;
            _914.y = _1025.y;
            _914.z = dot(_1025, vec3(-0.867447376251220703125, 1.867270946502685546875, 0.0));
            mat3 _1042 = mat3(vec3(5.4722118377685546875, -1.12524187564849853515625, 0.02980164997279644012451171875), vec3(-4.64196014404296875, 2.293170928955078125, -0.19318072497844696044921875), vec3(0.16963708400726318359375, -0.16789519786834716796875, 1.1636478900909423828125));
            vec3 _1043 = _914;
            _927 = _41(_1042, _1043);
            vec3 _1046 = _842 - _927;
            _888.x = (_1046.z * _851) + _1046.x;
            _888.y = (_1046.z * _851) + _1046.y;
            _888.z = 0.0;
          }
        }
      }
      vec3 _1071 = _842 + _888;
      vec3 _1067 = _22(_1071);
      _427 = mix(_842, _1067, vec3(_857));
    }
    vec4 _1078 = vec4(0.0);
    if (_686 == false) {
      _1078 = textureLod(sampler2D(_1084, _1086), vec4(_403, 0.0, 0.0).xy, vec4(_403, 0.0, 0.0).w);
      vec3 _1100 = _1078.xyz;
      vec3 _1103 = _28(_1100);
      _1078.x = _1103.x;
      _1078.y = _1103.y;
      _1078.z = _1103.z;
    }
    vec3 _1110 = (_427 * (1.0 - _1078.w)) + _1078.xyz;  // blend scene and ui
    vec3 _1120 = _1110;
    vec3 _1122 = _34(_1120);
    _1119.x = _1122.x;
    _1119.y = _1122.y;
    _1119.z = _1122.z;
    SPIRV_CROSS_FLATTEN
    if (_379._m0._m16 != 1.0) {
      vec4 _1137 = _1119;
      vec3 _1144 = pow(_1137.xyz, vec3(_379._m0._m16));
      _1119.x = _1144.x;
      _1119.y = _1144.y;
      _1119.z = _1144.z;
    }
    bool _1156 = _379._m0._m5.x > 0.0;
    bool _1165;
    if (!_1156) {
      _1165 = _379._m0._m5.y > 0.0;
    } else {
      _1165 = _1156;
    }
    bool _1174;
    if (!_1165) {
      _1174 = _379._m0._m5.z > 0.0;
    } else {
      _1174 = _1165;
    }
    bool _1182;
    if (_1174) {
      _1182 = _690._m48 == 0.0;
    } else {
      _1182 = _1174;
    }
    SPIRV_CROSS_BRANCH
    if (_1182) {
      vec2 _1185 = (vec2(ivec2(_366.xy)) + _379._m0._m6.xy) * _379._m0._m7.xy;
      vec3 _1206 = textureLod(sampler2D(_1207, _1209), vec4(_1185, 0.0, 0.0).xy, vec4(_1185, 0.0, 0.0).w).xyz;
      vec3 _1224 = (_1206 * 2.0) - vec3(1.0);
      vec3 _1229 = _1119.xyz;
      vec3 _1233 = _1229;
      float _1232 = _63(_1233);
      float _1243;
      if (_1232 < _379._m0._m5.w) {
        float _1260 = _1232 / _379._m0._m5.w;
        _1243 = mix(_379._m0._m5.x, _379._m0._m5.y, _10(_1260));
      } else {
        float _1284 = (_1232 - _379._m0._m5.w) / (1.0 - _379._m0._m5.w);
        _1243 = mix(_379._m0._m5.y, _379._m0._m5.z, _10(_1284));
      }
      float _1236 = _1243;
      vec3 _1293 = _1229 + (_1224 * _1236);
      vec3 _1294 = _22(_1293);
      _1119.x = _1294.x;
      _1119.y = _1294.y;
      _1119.z = _1294.z;
    }
    if ((_379._m0._m18 & 1u) != 0u) {
      vec3 _1311 = _427;
      vec3 _1310 = _34(_1311);
      SPIRV_CROSS_FLATTEN
      if (_379._m0._m16 != 1.0) {
        _1310 = pow(_1310, vec3(_379._m0._m16));
      }
      bool _1332 = _379._m0._m5.x > 0.0;
      bool _1341;
      if (!_1332) {
        _1341 = _379._m0._m5.y > 0.0;
      } else {
        _1341 = _1332;
      }
      bool _1350;
      if (!_1341) {
        _1350 = _379._m0._m5.z > 0.0;
      } else {
        _1350 = _1341;
      }
      bool _1356;
      if (_1350) {
        _1356 = _690._m48 == 0.0;
      } else {
        _1356 = _1350;
      }
      SPIRV_CROSS_BRANCH
      if (_1356) {
        vec2 _1359 = (vec2(ivec2(_366.xy)) + _379._m0._m6.xy) * _379._m0._m7.xy;
        vec3 _1378 = textureLod(sampler2D(_1207, _1209), vec4(_1359, 0.0, 0.0).xy, vec4(_1359, 0.0, 0.0).w).xyz;
        vec3 _1394 = (_1378 * 2.0) - vec3(1.0);
        vec3 _1399 = _1310;
        vec3 _1402 = _1399;
        float _1401 = _63(_1402);
        float _1412;
        if (_1401 < _379._m0._m5.w) {
          float _1429 = _1401 / _379._m0._m5.w;
          _1412 = mix(_379._m0._m5.x, _379._m0._m5.y, _10(_1429));
        } else {
          float _1453 = (_1401 - _379._m0._m5.w) / (1.0 - _379._m0._m5.w);
          _1412 = mix(_379._m0._m5.y, _379._m0._m5.z, _10(_1453));
        }
        float _1405 = _1412;
        vec3 _1462 = _1399 + (_1394 * _1405);
        _1310 = _22(_1462);
      }
      imageStore(_1466, ivec2(_366.xy), vec4(_1310, 1.0));
    }
  } else {
    _427 = max(vec3(0.0), _427);
    vec3 _1481 = _427;
    SPIRV_CROSS_BRANCH
    if (_379._m0._m4.x > 0.0) {
      float _1490 = _379._m0._m12;
      float _1495 = _379._m0._m13;
      _1481 = _59(_1481, mat3(vec3(0.63695812225341796875, 0.14461691677570343017578125, 0.168880939483642578125), vec3(0.2627002298831939697265625, 0.677998065948486328125, 0.059301711618900299072265625), vec3(0.0, 0.02807269059121608734130859375, 1.0609848499298095703125)), mat3(vec3(0.987228810787200927734375, -0.00611330009996891021728515625, 0.0159534104168415069580078125), vec3(-0.007598400115966796875, 1.00185978412628173828125, 0.0053300000727176666259765625), vec3(0.00307258008979260921478271484375, -0.0050959200598299503326416015625, 1.0816795825958251953125)), mat3(vec3(3.2409694194793701171875, -1.53738296031951904296875, -0.4986107647418975830078125), vec3(-0.96924388408660888671875, 1.87596786022186279296875, 0.041555099189281463623046875), vec3(0.055630020797252655029296875, -0.2039768397808074951171875, 1.0569713115692138671875)));
      float _1502 = mix(0.75, 2.5, _379._m0._m14);
      float _1509 = mix(0.0, 10.0, _379._m0._m15);
      _1481 = ((_1481 - vec3(5.0)) * vec3(_1502)) + vec3(_1509);
      vec3 _1526 = vec3(0.0);
      vec3 _1539;
      vec3 _1549;
      SPIRV_CROSS_BRANCH
      if (_379._m0._m4.x == 1.0) {
        mat3 _1535 = mat3(vec3(0.3139902055263519287109375, 0.1553724110126495361328125, 0.0177523903548717498779296875), vec3(0.639512956142425537109375, 0.757894456386566162109375, 0.109442092478275299072265625), vec3(0.0464975498616695404052734375, 0.0867014229297637939453125, 0.87256920337677001953125));
        vec3 _1536 = _1481;
        vec3 _1534 = _41(_1535, _1536);
        _1539.x = dot(_1534, vec3(0.0, 1.0511829853057861328125, -0.051160991191864013671875));
        _1539.y = _1534.y;
        _1539.z = _1534.z;
        mat3 _1550 = mat3(vec3(5.4722118377685546875, -1.12524187564849853515625, 0.02980164997279644012451171875), vec3(-4.64196014404296875, 2.293170928955078125, -0.19318072497844696044921875), vec3(0.16963708400726318359375, -0.16789519786834716796875, 1.1636478900909423828125));
        vec3 _1551 = _1539;
        _1549 = _41(_1550, _1551);
        vec3 _1554 = _1481 - _1549;
        _1526.x = 0.0;
        _1526.y = (_1554.x * _1490) + _1554.y;
        _1526.z = (_1554.x * _1490) + _1554.z;
      } else {
        SPIRV_CROSS_BRANCH
        if (_379._m0._m4.x == 2.0) {
          mat3 _1584 = mat3(vec3(0.3139902055263519287109375, 0.1553724110126495361328125, 0.0177523903548717498779296875), vec3(0.639512956142425537109375, 0.757894456386566162109375, 0.109442092478275299072265625), vec3(0.0464975498616695404052734375, 0.0867014229297637939453125, 0.87256920337677001953125));
          vec3 _1585 = _1481;
          vec3 _1583 = _41(_1584, _1585);
          _1539.x = _1583.x;
          _1539.y = dot(_1583, vec3(0.9513092041015625, 0.0, 0.04866991937160491943359375));
          _1539.z = _1583.z;
          mat3 _1597 = mat3(vec3(5.4722118377685546875, -1.12524187564849853515625, 0.02980164997279644012451171875), vec3(-4.64196014404296875, 2.293170928955078125, -0.19318072497844696044921875), vec3(0.16963708400726318359375, -0.16789519786834716796875, 1.1636478900909423828125));
          vec3 _1598 = _1539;
          _1549 = _41(_1597, _1598);
          vec3 _1601 = _1481 - _1549;
          _1526.x = (_1601.y * _1490) + _1601.x;
          _1526.y = 0.0;
          _1526.z = (_1601.y * _1490) + _1601.z;
        } else {
          SPIRV_CROSS_BRANCH
          if (_379._m0._m4.x == 3.0) {
            mat3 _1631 = mat3(vec3(0.3139902055263519287109375, 0.1553724110126495361328125, 0.0177523903548717498779296875), vec3(0.639512956142425537109375, 0.757894456386566162109375, 0.109442092478275299072265625), vec3(0.0464975498616695404052734375, 0.0867014229297637939453125, 0.87256920337677001953125));
            vec3 _1632 = _1481;
            vec3 _1630 = _41(_1631, _1632);
            _1539.x = _1630.x;
            _1539.y = _1630.y;
            _1539.z = dot(_1630, vec3(-0.867447376251220703125, 1.867270946502685546875, 0.0));
            mat3 _1644 = mat3(vec3(5.4722118377685546875, -1.12524187564849853515625, 0.02980164997279644012451171875), vec3(-4.64196014404296875, 2.293170928955078125, -0.19318072497844696044921875), vec3(0.16963708400726318359375, -0.16789519786834716796875, 1.1636478900909423828125));
            vec3 _1645 = _1539;
            _1549 = _41(_1644, _1645);
            vec3 _1648 = _1481 - _1549;
            _1526.x = (_1648.z * _1490) + _1648.x;
            _1526.y = (_1648.z * _1490) + _1648.y;
            _1526.z = 0.0;
          }
        }
      }
      vec3 _1669 = _1481 + _1526;
      _427 = mix(_1481, _1669, vec3(_1495));
      _427 = _59(_427, mat3(vec3(0.412390887737274169921875, 0.357584297657012939453125, 0.18048083782196044921875), vec3(0.2126390635967254638671875, 0.71516859531402587890625, 0.072192333638668060302734375), vec3(0.01933082006871700286865234375, 0.119194723665714263916015625, 0.95053231716156005859375)), mat3(vec3(1.01303005218505859375, 0.0061053098179399967193603515625, -0.014971000142395496368408203125), vec3(0.0076982299797236919403076171875, 0.99816501140594482421875, -0.005032029934227466583251953125), vec3(-0.0028413101099431514739990234375, 0.0046851597726345062255859375, 0.92450702190399169921875)), mat3(vec3(1.71665096282958984375, -0.35567080974578857421875, -0.2533662319183349609375), vec3(-0.666684329509735107421875, 1.616481304168701171875, 0.0157685391604900360107421875), vec3(0.0176398493349552154541015625, -0.04277060925960540771484375, 0.94210326671600341796875)));
    }
    vec4 _1719 = vec4(0.0);
    if (_686 == false) {
      _1719 = textureLod(sampler2D(_1084, _1086), vec4(_403, 0.0, 0.0).xy, vec4(_403, 0.0, 0.0).w);
      vec3 _1738 = _1719.xyz;
      vec3 _1741 = _28(_1738);
      _1719.x = _1741.x;
      _1719.y = _1741.y;
      _1719.z = _1741.z;
      vec3 _1750 = _52(_1719.xyz, mat3(vec3(0.412390887737274169921875, 0.357584297657012939453125, 0.18048083782196044921875), vec3(0.2126390635967254638671875, 0.71516859531402587890625, 0.072192333638668060302734375), vec3(0.01933082006871700286865234375, 0.119194723665714263916015625, 0.95053231716156005859375)), mat3(vec3(1.71665096282958984375, -0.35567080974578857421875, -0.2533662319183349609375), vec3(-0.666684329509735107421875, 1.616481304168701171875, 0.0157685391604900360107421875), vec3(0.0176398493349552154541015625, -0.04277060925960540771484375, 0.94210326671600341796875)));
      _1719.x = _1750.x;
      _1719.y = _1750.y;
      _1719.z = _1750.z;
      vec4 _1761 = _1719;
      vec3 _1763 = _1761.xyz * _379._m0._m11;  // UI Brightness
      _1719.x = _1763.x;
      _1719.y = _1763.y;
      _1719.z = _1763.z;
    }
    SPIRV_CROSS_BRANCH
    if ((_769 & 8u) != 0u) {
      vec3 _1776 = _427;
      _427 = _28(_1776);
      _427 = _52(_427, mat3(vec3(0.412390887737274169921875, 0.357584297657012939453125, 0.18048083782196044921875), vec3(0.2126390635967254638671875, 0.71516859531402587890625, 0.072192333638668060302734375), vec3(0.01933082006871700286865234375, 0.119194723665714263916015625, 0.95053231716156005859375)), mat3(vec3(1.71665096282958984375, -0.35567080974578857421875, -0.2533662319183349609375), vec3(-0.666684329509735107421875, 1.616481304168701171875, 0.0157685391604900360107421875), vec3(0.0176398493349552154541015625, -0.04277060925960540771484375, 0.94210326671600341796875)));
      _427 *= _379._m0._m11;  // UI Brightness
    }
    _427 *= _379._m0._m17;

    // moved up before UI composition
    bool enable_film_grain = (_690._m48 == 0.0) && ((_379._m0._m5.x > 0.0) || (_379._m0._m5.y > 0.0) || (_379._m0._m5.z > 0.0));

#if 1
    vec3 scene_bt2020 = _427;
    vec3 ui_bt2020 = _1719.xyz;
    float ui_brightness = _379._m0._m11;
    if (RENODX_SDR_EOTF_EMULATION_UI != 0.f) {
      ui_bt2020 /= ui_brightness;  // normalize UI brightness scene-referred
      vec3 ui_bt709 = BT709FromBT2020(ui_bt2020);

      ui_bt709 = CorrectGammaMismatch(ui_bt709, false);

      ui_bt2020 = BT2020FromBT709(ui_bt709);
      ui_bt2020 *= ui_brightness;  // back to display-referred
      _1719.xyz = ui_bt2020;
    }

    if (CUSTOM_FILM_GRAIN_TYPE != 0.f && enable_film_grain) {
      scene_bt2020 = ApplyFilmGrainBT2020(
          max(vec3(0.0), scene_bt2020),                                                                            // BT.2020 color
          vec2(_366.xy),                                                                                           // coords
          textureLod(sampler2D(_1207, _1209), (vec2(ivec2(_366.xy)) + _379._m0._m6.xy) * _379._m0._m7.xy, 0.0).x,  // seed
          _379._m0._m5.y * 0.05f,                                                                                  // strength
          100.f                                                                                                    // reference white
      );
      _427 = scene_bt2020;
    }
#endif

    vec3 _1801 = (_427 * (1.0 - _1719.w)) + _1719.xyz;

    _1119.x = _1801.x;
    _1119.y = _1801.y;
    _1119.z = _1801.z;
    // bool _1812 = _379._m0._m5.x > 0.0;
    // bool _1821;
    // if (!_1812) {
    //   _1821 = _379._m0._m5.y > 0.0;
    // } else {
    //   _1821 = _1812;
    // }
    // bool _1830;
    // if (!_1821) {
    //   _1830 = _379._m0._m5.z > 0.0;
    // } else {
    //   _1830 = _1821;
    // }
    // bool _1836;
    // if (_1830) {
    //   _1836 = _690._m48 == 0.0;
    // } else {
    //   _1836 = _1830;
    // }
    bool _1836 = enable_film_grain;  // moved up before UI composition

    SPIRV_CROSS_BRANCH
    if (_1836) {
#if 1
      if (CUSTOM_FILM_GRAIN_TYPE != 0.f) {
        // custom film grain applied earlier before UI composition
      } else {
        vec2 _1839 = (vec2(ivec2(_366.xy)) + _379._m0._m6.xy) * _379._m0._m7.xy;
        vec3 _1858 = textureLod(sampler2D(_1207, _1209), vec4(_1839, 0.0, 0.0).xy, vec4(_1839, 0.0, 0.0).w).xyz;
        vec3 _1874 = (_1858 * 2.0) - vec3(1.0);
        vec3 _1879 = _1119.xyz;
        _1879 = pow(_1119.xyz / vec3(200.0), vec3(0.4166666567325592041015625));
        vec3 _1890 = _1879;
        float _1889 = _63(_1890);
        float _1900;
        if (_1889 < _379._m0._m5.w) {
          float _1917 = _1889 / _379._m0._m5.w;
          _1900 = mix(_379._m0._m5.x, _379._m0._m5.y, _10(_1917));
        } else {
          float _1941 = (_1889 - _379._m0._m5.w) / (1.0 - _379._m0._m5.w);
          _1900 = mix(_379._m0._m5.y, _379._m0._m5.z, _10(_1941));
        }
        float _1893 = _1900;
        vec3 _1953 = pow(max(vec3(0.0), _1879 + (_1874 * _1893)), vec3(2.400000095367431640625)) * 200.0;
        _1119.x = _1953.x;
        _1119.y = _1953.y;
        _1119.z = _1953.z;
      }

#else
      vec2 _1839 = (vec2(ivec2(_366.xy)) + _379._m0._m6.xy) * _379._m0._m7.xy;
      vec3 _1858 = textureLod(sampler2D(_1207, _1209), vec4(_1839, 0.0, 0.0).xy, vec4(_1839, 0.0, 0.0).w).xyz;
      vec3 _1874 = (_1858 * 2.0) - vec3(1.0);
      vec3 _1879 = _1119.xyz;
      _1879 = pow(_1119.xyz / vec3(200.0), vec3(0.4166666567325592041015625));
      vec3 _1890 = _1879;
      float _1889 = _63(_1890);
      float _1900;
      if (_1889 < _379._m0._m5.w) {
        float _1917 = _1889 / _379._m0._m5.w;
        _1900 = mix(_379._m0._m5.x, _379._m0._m5.y, _10(_1917));
      } else {
        float _1941 = (_1889 - _379._m0._m5.w) / (1.0 - _379._m0._m5.w);
        _1900 = mix(_379._m0._m5.y, _379._m0._m5.z, _10(_1941));
      }
      float _1893 = _1900;
      vec3 _1953 = pow(max(vec3(0.0), _1879 + (_1874 * _1893)), vec3(2.400000095367431640625)) * 200.0;
      _1119.x = _1953.x;
      _1119.y = _1953.y;
      _1119.z = _1953.z;
#endif
    }
    vec3 _1960 = _1119.xyz;
    vec3 _1963 = _93(_1960);
    _1119.x = _1963.x;
    _1119.y = _1963.y;
    _1119.z = _1963.z;
    if ((_379._m0._m18 & 1u) != 0u) {
      vec3 _1978 = _427;
      bool _1984 = _379._m0._m5.x > 0.0;
      bool _1993;
      if (!_1984) {
        _1993 = _379._m0._m5.y > 0.0;
      } else {
        _1993 = _1984;
      }
      bool _2002;
      if (!_1993) {
        _2002 = _379._m0._m5.z > 0.0;
      } else {
        _2002 = _1993;
      }
      bool _2008;
      if (_2002) {
        _2008 = _690._m48 == 0.0;
      } else {
        _2008 = _2002;
      }
      SPIRV_CROSS_BRANCH
      if (_2008) {
        vec2 _2011 = (vec2(ivec2(_366.xy)) + _379._m0._m6.xy) * _379._m0._m7.xy;
        vec3 _2030 = textureLod(sampler2D(_1207, _1209), vec4(_2011, 0.0, 0.0).xy, vec4(_2011, 0.0, 0.0).w).xyz;
        vec3 _2046 = (_2030 * 2.0) - vec3(1.0);
        vec3 _2051 = _1978;
        _2051 = pow(_1978 / vec3(200.0), vec3(0.4166666567325592041015625));
        vec3 _2058 = _2051;
        float _2057 = _63(_2058);
        float _2068;
        if (_2057 < _379._m0._m5.w) {
          float _2085 = _2057 / _379._m0._m5.w;
          _2068 = mix(_379._m0._m5.x, _379._m0._m5.y, _10(_2085));
        } else {
          float _2109 = (_2057 - _379._m0._m5.w) / (1.0 - _379._m0._m5.w);
          _2068 = mix(_379._m0._m5.y, _379._m0._m5.z, _10(_2109));
        }
        float _2061 = _2068;
        _1978 = pow(max(vec3(0.0), _2051 + (_2046 * _2061)), vec3(2.400000095367431640625)) * 200.0;
      }
      vec3 _2121 = _1978;
      _1978 = _93(_2121);
      imageStore(_2126, ivec2(_366.xy), vec4(_1978, 1.0));
    }
  }
  _1119.w = 1.0;
  imageStore(_2141, ivec2(_379._m0._m8.xy / _379._m0._m8.zw) + _366.xy, _1119);
}

