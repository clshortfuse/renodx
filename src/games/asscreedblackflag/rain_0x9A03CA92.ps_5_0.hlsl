// ---- Created with 3Dmigoto v1.4.1 on Mon Nov 24 00:33:12 2025

cbuffer RainDropSystemConstantscb : register(b2)
{

  struct
  {
    float4x4 m_View;
    float4x4 m_InvView;
    float4x4 m_ViewProjection;
    float4x4 m_InvViewProjection;
    float4x4 m_InvProjection;
    float4 m_ZConstants;
    float4 m_CameraPosition;
    float4 m_CameraDirection;
    float4 m_FocusDistances;
    float4 m_RainDropParams;
    float4 m_ShapeParams_And_DOF_InterpolationDistanceRatio;
    uint4 m_ClusterIndex;
    uint4 m_RainDropCountInCluster;
    float4 m_DeltaTime;
    uint4 m_ActiveClustersFlag;
    float4 m_ScreenSize;
    float4 m_UseExtraLights;
    float4 m_OmniLight0_PositionFar;
    float4 m_OmniLight0_ColorFade;
    float4 m_OmniLight1_PositionFar;
    float4 m_OmniLight1_ColorFade;
    float4 m_OmniLight2_PositionFar;
    float4 m_OmniLight2_ColorFade;
    float4 m_OmniLight3_PositionFar;
    float4 m_OmniLight3_ColorFade;
    float4 m_OmniLight4_PositionFar;
    float4 m_OmniLight4_ColorFade;
    float4 m_OmniLight5_PositionFar;
    float4 m_OmniLight5_ColorFade;
    float4 m_OmniLight6_PositionFar;
    float4 m_OmniLight6_ColorFade;
    float4 m_OmniLight7_PositionFar;
    float4 m_OmniLight7_ColorFade;
    float4 m_DirectionLight0_Direction;
    float4 m_DirectionLight0_Color;
    float4 m_SpotLight0_PositionFar;
    float4 m_SpotLight0_ColorFade;
    float4 m_SpotLight0_Direction;
    float4 m_SpotLight0_ConeAngles;
    float4 m_XYExtents;
    float4 m_ZExtents;
    float4 m_StartVelocity;
    float4 m_StartVelocityVariance;
    float4 m_StartDirection;
    float4 m_StartDirectionVariance;
    float4 m_RainDropRippleLife;
    float4 m_RainDropRippleLifeVariance;
    float4 m_RandomSeed;
    uint4 m_InitialRandomIndexAndMax;
    float4 m_BounceParams;
    float4 m_GlobalWind;
    float4 m_GlobalWindPrecomputed;
    float4 m_GlobalWindPrecomputed2;
    float4 m_RippleParamsSet1;
    float4 m_RippleParamsSet2;
    float4 m_RippleParamsSet3;
    float4 m_DropletParamsSet1;
    float4 m_DropletParamsSet2;
    float4 m_RippleImpactSurfaceSizeAndInvSize;
    float4 m_DropletSurfaceSizeAndInvSize;
    float4x4 m_RainMatrix;
    float4 m_RainScale;
    float4 m_RainOffset;
    float4 m_WorldAOParameters;
    float4 m_WorldAORangeParameters;
    float4 m_WorldLightmapUVParameters;
  } g_RainDropSystemConstants : packoffset(c0);

}

SamplerComparisonState RainBlockingSampler_s : register(s15);
Texture2D<float4> RainBlockingTexture : register(t15);


// 3Dmigoto declarations
#define cmp -


void main(
  float4 v0 : SV_Position0,
  float2 v1 : RAINDROP_NORMAL0,
  out float4 o0 : SV_Target0)
{
  float4 r0,r1,r2,r3,r4;
  uint4 bitmask, uiDest;
  float4 fDest;

  r0.x = dot(v1.xy, v1.xy);
  r0.x = 1 + -r0.x;
  r0.y = cmp(r0.x < 0);
  if (r0.y != 0) discard;
  r1.z = sqrt(r0.x);
  r1.xy = v1.xy;
  r2.x = dot(r1.xyz, g_RainDropSystemConstants.m_InvView._m00_m10_m20);
  r2.y = dot(r1.xyz, g_RainDropSystemConstants.m_InvView._m01_m11_m21);
  r2.z = dot(r1.xyz, g_RainDropSystemConstants.m_InvView._m02_m12_m22);
  r0.y = dot(r2.xyz, r2.xyz);
  r0.y = rsqrt(r0.y);
  r0.yzw = r2.xyz * r0.yyy;
  r1.xy = g_RainDropSystemConstants.m_ScreenSize.zw * v0.xy;
  r1.xy = r1.xy * float2(2,2) + float2(-1,-1);
  r1.z = v0.z;
  r1.xyz = float3(1,-1,1) * r1.xyz;
  r1.w = 1;
  r2.x = dot(r1.xyzw, g_RainDropSystemConstants.m_InvViewProjection._m00_m10_m20_m30);
  r2.y = dot(r1.xyzw, g_RainDropSystemConstants.m_InvViewProjection._m01_m11_m21_m31);
  r2.z = dot(r1.xyzw, g_RainDropSystemConstants.m_InvViewProjection._m02_m12_m22_m32);
  r1.x = dot(r1.xyzw, g_RainDropSystemConstants.m_InvViewProjection._m03_m13_m23_m33);
  r1.xyz = r2.xyz / r1.xxx;
  r1.xyz = g_RainDropSystemConstants.m_CameraPosition.xyz + r1.xyz;
  r2.x = cmp(0 != g_RainDropSystemConstants.m_RainDropParams.z);
  r1.w = 1;
  r3.x = dot(r1.xyzw, g_RainDropSystemConstants.m_RainMatrix._m00_m10_m20_m30);
  r3.y = dot(r1.xyzw, g_RainDropSystemConstants.m_RainMatrix._m01_m11_m21_m31);
  r3.z = dot(r1.xyzw, g_RainDropSystemConstants.m_RainMatrix._m02_m12_m22_m32);
  r2.yzw = r3.xyz * g_RainDropSystemConstants.m_RainScale.xyz + g_RainDropSystemConstants.m_RainOffset.xyz;
  r2.yzw = float3(0.5,0.5,0.5) + r2.yzw;
  r1.w = RainBlockingTexture.SampleCmpLevelZero(RainBlockingSampler_s, r2.yz, r2.w).x;
  r1.w = r2.x ? r1.w : 1;
  r2.x = cmp(0 != g_RainDropSystemConstants.m_DirectionLight0_Direction.w);
  r2.y = dot(g_RainDropSystemConstants.m_DirectionLight0_Direction.xyz, r0.yzw);
  r2.z = saturate(r2.y);
  r2.y = 0.300000012 + -r2.y;
  r2.y = 0.5 * r2.y;
  r2.y = max(0, r2.y);
  r2.y = r2.z + r2.y;
  r2.y = min(1, r2.y);
  r2.yzw = g_RainDropSystemConstants.m_DirectionLight0_Color.xyz * r2.yyy;
  r2.xyz = r2.xxx ? r2.yzw : 0;
  r2.xyz = float3(0.0500000007,0.0500000007,0.100000001) + r2.xyz;
  r2.w = cmp(0 < g_RainDropSystemConstants.m_SpotLight0_PositionFar.w);
  r3.xyz = g_RainDropSystemConstants.m_SpotLight0_PositionFar.xyz + -r1.xyz;
  r3.w = dot(r3.xyz, r3.xyz);
  r4.x = g_RainDropSystemConstants.m_SpotLight0_PositionFar.w + -r3.w;
  r4.x = saturate(g_RainDropSystemConstants.m_SpotLight0_ColorFade.w * r4.x);
  r3.w = rsqrt(r3.w);
  r3.xyz = r3.xyz * r3.www;
  r3.w = dot(r3.xyz, g_RainDropSystemConstants.m_SpotLight0_Direction.xyz);
  r3.w = g_RainDropSystemConstants.m_SpotLight0_ConeAngles.x + -r3.w;
  r3.w = saturate(g_RainDropSystemConstants.m_SpotLight0_ConeAngles.y * r3.w);
  r3.w = r4.x * r3.w;
  r3.x = dot(r3.xyz, r0.yzw);
  r3.y = saturate(r3.x);
  r3.x = 0.300000012 + -r3.x;
  r3.x = 0.5 * r3.x;
  r3.x = max(0, r3.x);
  r3.x = r3.y + r3.x;
  r3.x = r3.x * r3.w;
  r3.x = min(1, r3.x);
  r3.xyz = g_RainDropSystemConstants.m_SpotLight0_ColorFade.xyz * r3.xxx;
  r3.xyz = r2.www ? r3.xyz : 0;
  r2.xyz = r3.xyz + r2.xyz;
  r2.w = cmp(0 < g_RainDropSystemConstants.m_UseExtraLights.x);
  if (r2.w != 0) {
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight0_PositionFar.w);
    r3.xyz = g_RainDropSystemConstants.m_OmniLight0_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r3.xyz, r3.xyz);
    r4.x = rsqrt(r3.w);
    r3.xyz = r4.xxx * r3.xyz;
    r3.w = g_RainDropSystemConstants.m_OmniLight0_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight0_ColorFade.w * r3.w);
    r3.x = dot(r3.xyz, r0.yzw);
    r3.y = 0.300000012 + -r3.x;
    r3.y = 0.5 * r3.y;
    r3.y = max(0, r3.y);
    r3.x = saturate(r3.x);
    r3.x = r3.x + r3.y;
    r3.x = r3.x * r3.w;
    r3.x = min(1, r3.x);
    r3.xyz = g_RainDropSystemConstants.m_OmniLight0_ColorFade.xyz * r3.xxx;
    r3.xyz = r2.www ? r3.xyz : 0;
    r3.xyz = r3.xyz + r2.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight1_PositionFar.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight1_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r4.xyz, r4.xyz);
    r4.w = rsqrt(r3.w);
    r4.xyz = r4.xyz * r4.www;
    r3.w = g_RainDropSystemConstants.m_OmniLight1_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight1_ColorFade.w * r3.w);
    r4.x = dot(r4.xyz, r0.yzw);
    r4.y = 0.300000012 + -r4.x;
    r4.y = 0.5 * r4.y;
    r4.y = max(0, r4.y);
    r4.x = saturate(r4.x);
    r4.x = r4.x + r4.y;
    r3.w = r4.x * r3.w;
    r3.w = min(1, r3.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight1_ColorFade.xyz * r3.www;
    r4.xyz = r2.www ? r4.xyz : 0;
    r3.xyz = r4.xyz + r3.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight2_PositionFar.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight2_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r4.xyz, r4.xyz);
    r4.w = rsqrt(r3.w);
    r4.xyz = r4.xyz * r4.www;
    r3.w = g_RainDropSystemConstants.m_OmniLight2_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight2_ColorFade.w * r3.w);
    r4.x = dot(r4.xyz, r0.yzw);
    r4.y = 0.300000012 + -r4.x;
    r4.y = 0.5 * r4.y;
    r4.y = max(0, r4.y);
    r4.x = saturate(r4.x);
    r4.x = r4.x + r4.y;
    r3.w = r4.x * r3.w;
    r3.w = min(1, r3.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight2_ColorFade.xyz * r3.www;
    r4.xyz = r2.www ? r4.xyz : 0;
    r3.xyz = r4.xyz + r3.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight3_PositionFar.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight3_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r4.xyz, r4.xyz);
    r4.w = rsqrt(r3.w);
    r4.xyz = r4.xyz * r4.www;
    r3.w = g_RainDropSystemConstants.m_OmniLight3_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight3_ColorFade.w * r3.w);
    r4.x = dot(r4.xyz, r0.yzw);
    r4.y = 0.300000012 + -r4.x;
    r4.y = 0.5 * r4.y;
    r4.y = max(0, r4.y);
    r4.x = saturate(r4.x);
    r4.x = r4.x + r4.y;
    r3.w = r4.x * r3.w;
    r3.w = min(1, r3.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight3_ColorFade.xyz * r3.www;
    r4.xyz = r2.www ? r4.xyz : 0;
    r3.xyz = r4.xyz + r3.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight4_PositionFar.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight4_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r4.xyz, r4.xyz);
    r4.w = rsqrt(r3.w);
    r4.xyz = r4.xyz * r4.www;
    r3.w = g_RainDropSystemConstants.m_OmniLight4_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight4_ColorFade.w * r3.w);
    r4.x = dot(r4.xyz, r0.yzw);
    r4.y = 0.300000012 + -r4.x;
    r4.y = 0.5 * r4.y;
    r4.y = max(0, r4.y);
    r4.x = saturate(r4.x);
    r4.x = r4.x + r4.y;
    r3.w = r4.x * r3.w;
    r3.w = min(1, r3.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight4_ColorFade.xyz * r3.www;
    r4.xyz = r2.www ? r4.xyz : 0;
    r3.xyz = r4.xyz + r3.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight5_PositionFar.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight5_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r4.xyz, r4.xyz);
    r4.w = rsqrt(r3.w);
    r4.xyz = r4.xyz * r4.www;
    r3.w = g_RainDropSystemConstants.m_OmniLight5_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight5_ColorFade.w * r3.w);
    r4.x = dot(r4.xyz, r0.yzw);
    r4.y = 0.300000012 + -r4.x;
    r4.y = 0.5 * r4.y;
    r4.y = max(0, r4.y);
    r4.x = saturate(r4.x);
    r4.x = r4.x + r4.y;
    r3.w = r4.x * r3.w;
    r3.w = min(1, r3.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight5_ColorFade.xyz * r3.www;
    r4.xyz = r2.www ? r4.xyz : 0;
    r3.xyz = r4.xyz + r3.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight6_PositionFar.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight6_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r4.xyz, r4.xyz);
    r4.w = rsqrt(r3.w);
    r4.xyz = r4.xyz * r4.www;
    r3.w = g_RainDropSystemConstants.m_OmniLight6_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight6_ColorFade.w * r3.w);
    r4.x = dot(r4.xyz, r0.yzw);
    r4.y = 0.300000012 + -r4.x;
    r4.y = 0.5 * r4.y;
    r4.y = max(0, r4.y);
    r4.x = saturate(r4.x);
    r4.x = r4.x + r4.y;
    r3.w = r4.x * r3.w;
    r3.w = min(1, r3.w);
    r4.xyz = g_RainDropSystemConstants.m_OmniLight6_ColorFade.xyz * r3.www;
    r4.xyz = r2.www ? r4.xyz : 0;
    r3.xyz = r4.xyz + r3.xyz;
    r2.w = cmp(0 < g_RainDropSystemConstants.m_OmniLight7_PositionFar.w);
    r1.xyz = g_RainDropSystemConstants.m_OmniLight7_PositionFar.xyz + -r1.xyz;
    r3.w = dot(r1.xyz, r1.xyz);
    r4.x = rsqrt(r3.w);
    r1.xyz = r4.xxx * r1.xyz;
    r3.w = g_RainDropSystemConstants.m_OmniLight7_PositionFar.w + -r3.w;
    r3.w = saturate(g_RainDropSystemConstants.m_OmniLight7_ColorFade.w * r3.w);
    r0.y = dot(r1.xyz, r0.yzw);
    r0.z = 0.300000012 + -r0.y;
    r0.z = 0.5 * r0.z;
    r0.z = max(0, r0.z);
    r0.y = saturate(r0.y);
    r0.y = r0.y + r0.z;
    r0.y = r0.y * r3.w;
    r0.y = min(1, r0.y);
    r0.yzw = g_RainDropSystemConstants.m_OmniLight7_ColorFade.xyz * r0.yyy;
    r0.yzw = r2.www ? r0.yzw : 0;
    r2.xyz = r3.xyz + r0.yzw;
  }
  o0.xyz = sqrt(r2.xyz);
  r0.y = g_RainDropSystemConstants.m_ShapeParams_And_DOF_InterpolationDistanceRatio.w * r1.w;
  r0.x = r0.y * r0.x;
  o0.w = max(0, r0.x);
  
  o0.w = saturate(o0.w);
  return;
}