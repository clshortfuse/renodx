#include "..\lutbuilder.hlsli"

cbuffer CB0_buf : register(b2200, space0) {
  float3 CB0_m0 : packoffset(c0);
  uint CB0_m1 : packoffset(c0.w);
};

cbuffer CB1_buf : register(b2201, space0) {
  uint4 CB1_m[4096] : packoffset(c0);
};

cbuffer CB2_buf : register(b0, space2) {
  uint4 CB2_m0 : packoffset(c0);
  uint4 CB2_m1 : packoffset(c1);
  uint4 CB2_m2 : packoffset(c2);
  uint4 CB2_m3 : packoffset(c3);
  uint4 CB2_m4 : packoffset(c4);
  uint4 CB2_m5 : packoffset(c5);
  uint4 CB2_m6 : packoffset(c6);
  uint4 CB2_m7 : packoffset(c7);
  uint4 CB2_m8 : packoffset(c8);
  uint4 CB2_m9 : packoffset(c9);
  uint4 CB2_m10 : packoffset(c10);
  uint4 CB2_m11 : packoffset(c11);
};

RWTexture3D<float4> U0[] : register(u0, space2820);

static uint3 gl_GlobalInvocationID;
struct SPIRV_Cross_Input {
  uint3 gl_GlobalInvocationID : SV_DispatchThreadID;
};

float dp3_f32(float3 a, float3 b) {
  precise float _235 = a.x * b.x;
  return mad(a.z, b.z, mad(a.y, b.y, _235));
}

float dp2_f32(float2 a, float2 b) {
  precise float _223 = a.x * b.x;
  return mad(a.y, b.y, _223);
}

void comp_main() {
  float _252 = float(gl_GlobalInvocationID.x);
  float _253 = float(gl_GlobalInvocationID.y);
  float _254 = float(gl_GlobalInvocationID.z);
  float _262 = _252 * CB0_m0.x;
  float _263 = _253 * CB0_m0.y;
  float _264 = _254 * CB0_m0.z;
  float _1342;
  float _1343;
  float _1344;
  if (CB1_m[0u].x != 0u) {
    float _935;
    float _936;
    float _937;
    if (CB1_m[0u].y != 0u) {
      bool _278 = _264 < _263;
      float _279 = _278 ? _263 : _264;
      float _280 = _278 ? _264 : _263;
      bool _283 = _262 > _279;
      float _284 = _283 ? _262 : _279;
      float _286 = _283 ? _279 : _262;
      float _288 = _284 - min(_280, _286);
      float _292 = ((_286 - _280) / mad(_288, 6.0f, 1.0000000133514319600180897396058e-10f)) + (_283 ? (_278 ? 0.0f : (-1.0f)) : (_278 ? (-0.3333333432674407958984375f) : 0.666666686534881591796875f));
      float _294 = _288 / (_284 + 1.0000000133514319600180897396058e-10f);
      uint _400;
      uint _401;
      uint _402;
      uint _403;
      if (!((asfloat(CB1_m[20u].y) == 0.0f) && ((asfloat(CB1_m[20u].x) == 0.0f) && (asfloat(CB1_m[20u].z) == 0.0f)))) {
        float _313 = abs(_292);
        float _315 = abs(_313 - 1.0f);
        float _333 = min(clamp((asfloat(CB1_m[8u].x) - min(_315, 1.0f - _315)) * asfloat(CB1_m[8u].y), 0.0f, 1.0f), clamp((_294 - asfloat(CB1_m[8u].z)) * 10.0f, 0.0f, 1.0f));
        bool _334 = _333 != 0.0f;
        float _338 = _313 + asfloat(CB1_m[20u].x);
        float _343 = clamp(_294 + asfloat(CB1_m[20u].y), 0.0f, 1.0f);
        float _370 = asfloat(CB1_m[20u].z);
        _400 = _334 ? asuint(_333) : 0u;
        _401 = _334 ? asuint(_333 * (_264 + (_333 * mad(-_254, CB0_m0.z, clamp(mad(mad(_343, clamp(abs(mad(frac(_338 + 0.3333333432674407958984375f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _370), 0.0f, 1.0f))))) : 0u;
        _402 = _334 ? asuint(_333 * (_263 + (_333 * mad(-_253, CB0_m0.y, clamp(mad(mad(_343, clamp(abs(mad(frac(_338 + 0.666666686534881591796875f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _370), 0.0f, 1.0f))))) : 0u;
        _403 = _334 ? asuint(_333 * (_262 + (_333 * mad(-_252, CB0_m0.x, clamp(mad(mad(_343, clamp(abs(mad(frac(_338 + 1.0f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _370), 0.0f, 1.0f))))) : 0u;
      } else {
        _400 = 0u;
        _401 = 0u;
        _402 = 0u;
        _403 = 0u;
      }
      float _404 = asfloat(_403);
      float _405 = asfloat(_402);
      float _406 = asfloat(_401);
      float _407 = asfloat(_400);
      float _508;
      float _509;
      float _510;
      float _511;
      if (!(((asfloat(CB1_m[21u].x) == 0.0f) && (asfloat(CB1_m[21u].z) == 0.0f)) && (asfloat(CB1_m[21u].y) == 0.0f))) {
        float _424 = abs(_292);
        float _426 = abs(_424 - 0.3333333432674407958984375f);
        float _444 = min(clamp((asfloat(CB1_m[8u].x) - min(_426, 1.0f - _426)) * asfloat(CB1_m[8u].y), 0.0f, 1.0f), clamp((_294 - asfloat(CB1_m[8u].z)) * 10.0f, 0.0f, 1.0f));
        bool _445 = _444 != 0.0f;
        float _449 = _424 + asfloat(CB1_m[21u].x);
        float _454 = clamp(_294 + asfloat(CB1_m[21u].y), 0.0f, 1.0f);
        float _481 = asfloat(CB1_m[21u].z);
        _508 = _445 ? (_444 + _407) : _407;
        _509 = _445 ? mad(_444, _264 + (_444 * mad(-_254, CB0_m0.z, clamp(mad(_284, mad(_454, clamp(abs(mad(frac(_449 + 0.3333333432674407958984375f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _481), 0.0f, 1.0f))), _406) : _406;
        _510 = _445 ? mad(_444, _263 + (_444 * mad(-_253, CB0_m0.y, clamp(mad(_284, mad(_454, clamp(abs(mad(frac(_449 + 0.666666686534881591796875f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _481), 0.0f, 1.0f))), _405) : _405;
        _511 = _445 ? mad(_444, _262 + (_444 * mad(-_252, CB0_m0.x, clamp(mad(mad(_454, clamp(abs(mad(frac(_449 + 1.0f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _481), 0.0f, 1.0f))), _404) : _404;
      } else {
        _508 = _407;
        _509 = _406;
        _510 = _405;
        _511 = _404;
      }
      float _612;
      float _613;
      float _614;
      float _615;
      if (!((asfloat(CB1_m[22u].y) == 0.0f) && ((asfloat(CB1_m[22u].x) == 0.0f) && (asfloat(CB1_m[22u].z) == 0.0f)))) {
        float _528 = abs(_292);
        float _530 = abs(_528 - 0.666666686534881591796875f);
        float _548 = min(clamp((asfloat(CB1_m[8u].x) - min(_530, 1.0f - _530)) * asfloat(CB1_m[8u].y), 0.0f, 1.0f), clamp((_294 - asfloat(CB1_m[8u].z)) * 10.0f, 0.0f, 1.0f));
        bool _549 = _548 != 0.0f;
        float _553 = _528 + asfloat(CB1_m[22u].x);
        float _558 = clamp(_294 + asfloat(CB1_m[22u].y), 0.0f, 1.0f);
        float _585 = asfloat(CB1_m[22u].z);
        _612 = _549 ? (_548 + _508) : _508;
        _613 = _549 ? mad(_548, _264 + (_548 * mad(-_254, CB0_m0.z, clamp(mad(_284, mad(_558, clamp(abs(mad(frac(_553 + 0.3333333432674407958984375f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _585), 0.0f, 1.0f))), _509) : _509;
        _614 = _549 ? mad(_548, _263 + (_548 * mad(-_253, CB0_m0.y, clamp(mad(_284, mad(_558, clamp(abs(mad(frac(_553 + 0.666666686534881591796875f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _585), 0.0f, 1.0f))), _510) : _510;
        _615 = _549 ? mad(_548, _262 + (_548 * mad(-_252, CB0_m0.x, clamp(mad(mad(_558, clamp(abs(mad(frac(_553 + 1.0f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _585), 0.0f, 1.0f))), _511) : _511;
      } else {
        _612 = _508;
        _613 = _509;
        _614 = _510;
        _615 = _511;
      }
      float _716;
      float _717;
      float _718;
      float _719;
      if (!((asfloat(CB1_m[23u].y) == 0.0f) && ((asfloat(CB1_m[23u].x) == 0.0f) && (asfloat(CB1_m[23u].z) == 0.0f)))) {
        float _632 = abs(_292);
        float _634 = abs(_632 - 0.5f);
        float _652 = min(clamp((asfloat(CB1_m[8u].x) - min(_634, 1.0f - _634)) * asfloat(CB1_m[8u].y), 0.0f, 1.0f), clamp((_294 - asfloat(CB1_m[8u].z)) * 10.0f, 0.0f, 1.0f));
        bool _653 = _652 != 0.0f;
        float _657 = _632 + asfloat(CB1_m[23u].x);
        float _662 = clamp(_294 + asfloat(CB1_m[23u].y), 0.0f, 1.0f);
        float _689 = asfloat(CB1_m[23u].z);
        _716 = _653 ? (_652 + _612) : _612;
        _717 = _653 ? mad(_652, _264 + (_652 * mad(-_254, CB0_m0.z, clamp(mad(_284, mad(_662, clamp(abs(mad(frac(_657 + 0.3333333432674407958984375f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _689), 0.0f, 1.0f))), _613) : _613;
        _718 = _653 ? mad(_652, _263 + (_652 * mad(-_253, CB0_m0.y, clamp(mad(_284, mad(_662, clamp(abs(mad(frac(_657 + 0.666666686534881591796875f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _689), 0.0f, 1.0f))), _614) : _614;
        _719 = _653 ? mad(_652, _262 + (_652 * mad(-_252, CB0_m0.x, clamp(mad(mad(_662, clamp(abs(mad(frac(_657 + 1.0f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _689), 0.0f, 1.0f))), _615) : _615;
      } else {
        _716 = _612;
        _717 = _613;
        _718 = _614;
        _719 = _615;
      }
      float _820;
      float _821;
      float _822;
      float _823;
      if (!((asfloat(CB1_m[24u].y) == 0.0f) && ((asfloat(CB1_m[24u].x) == 0.0f) && (asfloat(CB1_m[24u].z) == 0.0f)))) {
        float _736 = abs(_292);
        float _738 = abs(_736 - 0.83333337306976318359375f);
        float _756 = min(clamp((asfloat(CB1_m[8u].x) - min(_738, 1.0f - _738)) * asfloat(CB1_m[8u].y), 0.0f, 1.0f), clamp((_294 - asfloat(CB1_m[8u].z)) * 10.0f, 0.0f, 1.0f));
        bool _757 = _756 != 0.0f;
        float _761 = _736 + asfloat(CB1_m[24u].x);
        float _766 = clamp(_294 + asfloat(CB1_m[24u].y), 0.0f, 1.0f);
        float _793 = asfloat(CB1_m[24u].z);
        _820 = _757 ? (_756 + _716) : _716;
        _821 = _757 ? mad(_756, _264 + (_756 * mad(-_254, CB0_m0.z, clamp(mad(mad(_766, clamp(abs(mad(frac(_761 + 0.3333333432674407958984375f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _793), 0.0f, 1.0f))), _717) : _717;
        _822 = _757 ? mad(_756, _263 + (_756 * mad(-_253, CB0_m0.y, clamp(mad(mad(_766, clamp(abs(mad(frac(_761 + 0.666666686534881591796875f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _793), 0.0f, 1.0f))), _718) : _718;
        _823 = _757 ? mad(_756, _262 + (_756 * mad(-_252, CB0_m0.x, clamp(mad(mad(_766, clamp(abs(mad(frac(_761 + 1.0f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _793), 0.0f, 1.0f))), _719) : _719;
      } else {
        _820 = _716;
        _821 = _717;
        _822 = _718;
        _823 = _719;
      }
      float _924;
      float _925;
      float _926;
      float _927;
      if (!((asfloat(CB1_m[25u].y) == 0.0f) && ((asfloat(CB1_m[25u].x) == 0.0f) && (asfloat(CB1_m[25u].z) == 0.0f)))) {
        float _840 = abs(_292);
        float _842 = abs(_840 - 0.16666667163372039794921875f);
        float _860 = min(clamp((asfloat(CB1_m[8u].x) - min(_842, 1.0f - _842)) * asfloat(CB1_m[8u].y), 0.0f, 1.0f), clamp((_294 - asfloat(CB1_m[8u].z)) * 10.0f, 0.0f, 1.0f));
        bool _861 = _860 != 0.0f;
        float _865 = _840 + asfloat(CB1_m[25u].x);
        float _870 = clamp(_294 + asfloat(CB1_m[25u].y), 0.0f, 1.0f);
        float _897 = asfloat(CB1_m[25u].z);
        _924 = _861 ? mad(_860, _264 + (_860 * mad(-_254, CB0_m0.z, clamp(mad(mad(_870, clamp(abs(mad(frac(_865 + 0.3333333432674407958984375f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _897), 0.0f, 1.0f))), _821) : _821;
        _925 = _861 ? mad(_860, _263 + (_860 * mad(-_253, CB0_m0.y, clamp(mad(mad(_870, clamp(abs(mad(frac(_865 + 0.666666686534881591796875f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _897), 0.0f, 1.0f))), _822) : _822;
        _926 = _861 ? mad(_860, _262 + (_860 * mad(-_252, CB0_m0.x, clamp(mad(mad(_870, clamp(abs(mad(frac(_865 + 1.0f), 6.0f, -3.0f)) - 1.0f, 0.0f, 1.0f) - 1.0f, 1.0f), _284, _897), 0.0f, 1.0f))), _823) : _823;
        _927 = _861 ? (_860 + _820) : _820;
      } else {
        _924 = _821;
        _925 = _822;
        _926 = _823;
        _927 = _820;
      }
      bool _928 = _927 >= 9.9999997473787516355514526367188e-05f;
      _935 = _928 ? (_924 / _927) : _264;
      _936 = _928 ? (_925 / _927) : _263;
      _937 = _928 ? (_926 / _927) : _262;
    } else {
      _935 = _264;
      _936 = _263;
      _937 = _262;
    }
    float3 _946 = float3(asfloat(CB1_m[9u].x), asfloat(CB1_m[9u].y), asfloat(CB1_m[9u].z));
    float _956 = mad(log2(dp3_f32(float3(0.61319148540496826171875f, 0.3395120799541473388671875f, 0.0473663322627544403076171875f), _946)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _957 = mad(log2(dp3_f32(float3(0.070206902921199798583984375f, 0.9163358211517333984375f, 0.01345001161098480224609375f), _946)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _958 = mad(log2(dp3_f32(float3(0.02061887085437774658203125f, 0.109567292034626007080078125f, 0.8696067333221435546875f), _946)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float3 _959 = float3(_956, _957, _958);
    float _961 = rsqrt(dp3_f32(_959, _959));
    float _968 = asfloat(CB1_m[9u].w) * 0.0555555559694766998291015625f;
    float _972 = _968 + ((_961 * _956) * 1.73205089569091796875f);
    float _973 = _968 + ((_961 * _957) * 1.73205089569091796875f);
    float _974 = _968 + ((_961 * _958) * 1.73205089569091796875f);
    float3 _983 = float3(asfloat(CB1_m[10u].x), asfloat(CB1_m[10u].y), asfloat(CB1_m[10u].z));
    float _993 = mad(log2(dp3_f32(float3(0.61319148540496826171875f, 0.3395120799541473388671875f, 0.0473663322627544403076171875f), _983)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _994 = mad(log2(dp3_f32(float3(0.070206902921199798583984375f, 0.9163358211517333984375f, 0.01345001161098480224609375f), _983)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _995 = mad(log2(dp3_f32(float3(0.02061887085437774658203125f, 0.109567292034626007080078125f, 0.8696067333221435546875f), _983)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float3 _996 = float3(_993, _994, _995);
    float _998 = rsqrt(dp3_f32(_996, _996));
    float _1005 = asfloat(CB1_m[10u].w) * 0.0555555559694766998291015625f;
    float _1009 = ((_993 * _998) * 1.73205089569091796875f) + _1005;
    float _1010 = _1005 + ((_998 * _994) * 1.73205089569091796875f);
    float _1011 = _1005 + ((_998 * _995) * 1.73205089569091796875f);
    float3 _1020 = float3(asfloat(CB1_m[11u].x), asfloat(CB1_m[11u].y), asfloat(CB1_m[11u].z));
    float _1030 = mad(log2(dp3_f32(float3(0.61319148540496826171875f, 0.3395120799541473388671875f, 0.0473663322627544403076171875f), _1020)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _1031 = mad(log2(dp3_f32(float3(0.070206902921199798583984375f, 0.9163358211517333984375f, 0.01345001161098480224609375f), _1020)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _1032 = mad(log2(dp3_f32(float3(0.02061887085437774658203125f, 0.109567292034626007080078125f, 0.8696067333221435546875f), _1020)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float3 _1033 = float3(_1030, _1031, _1032);
    float _1035 = rsqrt(dp3_f32(_1033, _1033));
    float _1042 = asfloat(CB1_m[11u].w) * 0.0555555559694766998291015625f;
    float _1055 = clamp((_937 - 0.273893058300018310546875f) * 6.96335124969482421875f, 0.0f, 1.0f);
    float _1056 = clamp((_936 - 0.273893058300018310546875f) * 6.96335124969482421875f, 0.0f, 1.0f);
    float _1057 = clamp((_935 - 0.273893058300018310546875f) * 6.96335124969482421875f, 0.0f, 1.0f);
    float _1073 = clamp((_937 - 0.4584445953369140625f) * 11.35673618316650390625f, 0.0f, 1.0f);
    float _1074 = clamp((_936 - 0.4584445953369140625f) * 11.35673618316650390625f, 0.0f, 1.0f);
    float _1075 = clamp((_935 - 0.4584445953369140625f) * 11.35673618316650390625f, 0.0f, 1.0f);
    float _1105 = asfloat(CB1_m[12u].w);
    float _1109 = clamp(mad(_1105, 0.0555555559694766998291015625f, clamp(mad(mad(_1055, -2.0f, 3.0f) * (_1055 * _1055), mad(mad(_1073, -2.0f, 3.0f) * (_1073 * _1073), (((_1030 * _1035) * 1.73205089569091796875f) + _1042) - _1009, _1009) - _972, _972) * _937, 0.0f, 1.0f)), 0.0f, 1.0f);
    float _1110 = clamp(mad(_1105, 0.0555555559694766998291015625f, clamp(mad(mad((_1042 + ((_1035 * _1031) * 1.73205089569091796875f)) - _1010, (_1074 * _1074) * mad(_1074, -2.0f, 3.0f), _1010) - _973, (_1056 * _1056) * mad(_1056, -2.0f, 3.0f), _973) * _936, 0.0f, 1.0f)), 0.0f, 1.0f);
    float _1111 = clamp(mad(_1105, 0.0555555559694766998291015625f, clamp(mad(mad((_1042 + ((_1035 * _1032) * 1.73205089569091796875f)) - _1011, (_1075 * _1075) * mad(_1075, -2.0f, 3.0f), _1011) - _974, (_1057 * _1057) * mad(_1057, -2.0f, 3.0f), _974) * _935, 0.0f, 1.0f)), 0.0f, 1.0f);
    float _1114 = asfloat(CB1_m[13u].y);
    bool _1115 = _1114 != 1.0f;
    float _1122 = exp2((_1109 - 0.449999988079071044921875f) * 18.0f);
    float _1123 = exp2((_1110 - 0.449999988079071044921875f) * 18.0f);
    float _1124 = exp2((_1111 - 0.449999988079071044921875f) * 18.0f);
    float _1129 = dp3_f32(float3(0.25f, 0.5f, 0.25f), float3(_1122 * 0.180000007152557373046875f, _1123 * 0.180000007152557373046875f, _1124 * 0.180000007152557373046875f));
    float _1159 = asfloat(CB1_m[13u].x);
    float3 _1174 = float3(asfloat(CB1_m[12u].x), asfloat(CB1_m[12u].y), asfloat(CB1_m[12u].z));
    float _1184 = mad(log2(dp3_f32(float3(0.61319148540496826171875f, 0.3395120799541473388671875f, 0.0473663322627544403076171875f), _1174)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _1185 = mad(log2(dp3_f32(float3(0.070206902921199798583984375f, 0.9163358211517333984375f, 0.01345001161098480224609375f), _1174)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _1186 = mad(log2(dp3_f32(float3(0.02061887085437774658203125f, 0.109567292034626007080078125f, 0.8696067333221435546875f), _1174)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float3 _1187 = float3(_1184, _1185, _1186);
    float _1189 = rsqrt(dp3_f32(_1187, _1187));
    float _1199 = clamp((clamp(mad((_1115 ? clamp(mad(log2(mad(_1114, mad(_1122, 0.180000007152557373046875f, -_1129), _1129)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f), 0.0f, 1.0f) : _1109) - 0.449999988079071044921875f, _1159, 0.449999988079071044921875f), 0.0f, 1.0f) * (_1184 * _1189)) * 1.73205089569091796875f, 0.0f, 1.0f);
    float _1200 = clamp(((_1189 * _1185) * clamp(mad(_1159, (_1115 ? clamp(mad(log2(mad(_1114, mad(_1123, 0.180000007152557373046875f, -_1129), _1129)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f), 0.0f, 1.0f) : _1110) - 0.449999988079071044921875f, 0.449999988079071044921875f), 0.0f, 1.0f)) * 1.73205089569091796875f, 0.0f, 1.0f);
    float _1201 = clamp(((_1189 * _1186) * clamp(mad(_1159, (_1115 ? clamp(mad(log2(mad(_1114, mad(_1124, 0.180000007152557373046875f, -_1129), _1129)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f), 0.0f, 1.0f) : _1111) - 0.449999988079071044921875f, 0.449999988079071044921875f), 0.0f, 1.0f)) * 1.73205089569091796875f, 0.0f, 1.0f);
    float _1203 = dp3_f32(float3(_1199, _1201, _1200), float3(0.25f, 0.25f, 0.5f));
    bool _1204 = _1203 < 0.4584445953369140625f;
    float _1206 = _1204 ? (-0.273893058300018310546875f) : (-0.5464980602264404296875f);
    float _1210 = clamp((_1203 + _1206) / ((_1204 ? 0.4175020754337310791015625f : 0.4584445953369140625f) + _1206), 0.0f, 1.0f);
    float _1213 = mad(_1210, -2.0f, 3.0f) * (_1210 * _1210);
    uint _1214 = _1204 ? 14u : 18u;
    float _1221 = asfloat(CB1_m[_1214].x);
    float _1222 = asfloat(CB1_m[_1214].y);
    float _1223 = asfloat(CB1_m[_1214].z);
    float _1224 = asfloat(CB1_m[_1214].w);
    float _1242 = mad(_1213, asfloat(CB1_m[16u].w) - _1224, _1224);
    uint _1243 = _1204 ? 15u : 19u;
    float _1248 = asfloat(CB1_m[_1243].x);
    float _1249 = asfloat(CB1_m[_1243].y);
    float _1258 = mad(_1213, asfloat(CB1_m[17u].x) - _1248, _1248);
    float _1259 = mad(_1213, asfloat(CB1_m[17u].y) - _1249, _1249);
    float _1263 = clamp(mad(_1242, 0.0555555559694766998291015625f, _1199), 0.0f, 1.0f);
    float _1264 = clamp(mad(_1242, 0.0555555559694766998291015625f, _1200), 0.0f, 1.0f);
    float _1265 = clamp(mad(_1242, 0.0555555559694766998291015625f, _1201), 0.0f, 1.0f);
    bool _1266 = _1259 != 1.0f;
    float _1273 = exp2((_1263 - 0.449999988079071044921875f) * 18.0f);
    float _1274 = exp2((_1264 - 0.449999988079071044921875f) * 18.0f);
    float _1275 = exp2((_1265 - 0.449999988079071044921875f) * 18.0f);
    float _1280 = dp3_f32(float3(0.25f, 0.5f, 0.25f), float3(_1273 * 0.180000007152557373046875f, _1274 * 0.180000007152557373046875f, _1275 * 0.180000007152557373046875f));
    float3 _1314 = float3(mad(_1213, asfloat(CB1_m[16u].x) - _1221, _1221), mad(_1213, asfloat(CB1_m[16u].y) - _1222, _1222), mad(_1213, asfloat(CB1_m[16u].z) - _1223, _1223));
    float _1324 = mad(log2(dp3_f32(float3(0.61319148540496826171875f, 0.3395120799541473388671875f, 0.0473663322627544403076171875f), _1314)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _1325 = mad(log2(dp3_f32(float3(0.070206902921199798583984375f, 0.9163358211517333984375f, 0.01345001161098480224609375f), _1314)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float _1326 = mad(log2(dp3_f32(float3(0.02061887085437774658203125f, 0.109567292034626007080078125f, 0.8696067333221435546875f), _1314)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f);
    float3 _1327 = float3(_1324, _1325, _1326);
    float _1329 = rsqrt(dp3_f32(_1327, _1327));
    _1342 = clamp(((_1326 * _1329) * clamp(mad(_1258, (_1266 ? clamp(mad(log2(mad(mad(_1275, 0.180000007152557373046875f, -_1280), _1259, _1280)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f), 0.0f, 1.0f) : _1265) - 0.449999988079071044921875f, 0.449999988079071044921875f), 0.0f, 1.0f)) * 1.73205089569091796875f, 0.0f, 1.0f);
    _1343 = clamp(((_1325 * _1329) * clamp(mad(_1258, (_1266 ? clamp(mad(log2(mad(mad(_1274, 0.180000007152557373046875f, -_1280), _1259, _1280)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f), 0.0f, 1.0f) : _1264) - 0.449999988079071044921875f, 0.449999988079071044921875f), 0.0f, 1.0f)) * 1.73205089569091796875f, 0.0f, 1.0f);
    _1344 = clamp((clamp(mad(_1258, (_1266 ? clamp(mad(log2(mad(mad(_1273, 0.180000007152557373046875f, -_1280), _1259, _1280)) + 2.4739310741424560546875f, 0.0555555559694766998291015625f, 0.449999988079071044921875f), 0.0f, 1.0f) : _1263) - 0.449999988079071044921875f, 0.449999988079071044921875f), 0.0f, 1.0f) * (_1324 * _1329)) * 1.73205089569091796875f, 0.0f, 1.0f);
  } else {
    _1342 = _264;
    _1343 = _263;
    _1344 = _262;
  }
  float _1354 = exp2((clamp(_1344, 0.0f, 1.0f) - 0.449999988079071044921875f) * 18.0f);
  float _1355 = exp2((clamp(_1343, 0.0f, 1.0f) - 0.449999988079071044921875f) * 18.0f);
  float _1356 = exp2((clamp(_1342, 0.0f, 1.0f) - 0.449999988079071044921875f) * 18.0f);
  float _1365 = dp3_f32(
      float3(_1354 * 0.180000007152557373046875f,
             _1355 * 0.180000007152557373046875f,
             _1356 * 0.180000007152557373046875f),
      asfloat(CB1_m[0u].w).xxx);
  float3 _1369 = float3(mad(_1354, 0.180000007152557373046875f, _1365),
                        mad(_1355, 0.180000007152557373046875f, _1365),
                        mad(_1356, 0.180000007152557373046875f, _1365));

#if 1  // custom tonemapper
  float3 ungraded_bt709 = _1369;
  if (RENODX_TONE_MAP_TYPE != 0 && RENODX_TONE_MAP_TYPE != 3.f) {
    float contrast = asfloat(CB1_m[4u].x);
    U0[CB2_m11.y][gl_GlobalInvocationID] = float4(GenerateOutputAvatar(ungraded_bt709, contrast), 1.f);
    return;
  }
#endif

  // BT.709 -> AP1
  float3 _1373 = float3(dp3_f32(float3(0.61319148540496826171875f, 0.3395120799541473388671875f, 0.0473663322627544403076171875f), _1369),
                        dp3_f32(float3(0.070206902921199798583984375f, 0.9163358211517333984375f, 0.01345001161098480224609375f), _1369),
                        dp3_f32(float3(0.02061887085437774658203125f, 0.109567292034626007080078125f, 0.8696067333221435546875f), _1369));

  // AP1 -> ICtCp LMS
  float _1377 = max(dp3_f32(float3(0.450864851474761962890625f, 0.528371751308441162109375f, 0.02073897421360015869140625f), _1373), 0.0f);
  float _1378 = max(dp3_f32(float3(0.1640706360340118408203125f, 0.756849944591522216796875f, 0.079059422016143798828125f), _1373), 0.0f);
  float _1379 = max(dp3_f32(float3(-0.004941581748425960540771484375f, 0.001257075113244354724884033203125f, 1.00365674495697021484375f), _1373), 0.0f);

  // Linear -> PQ
  float _1382 = asfloat(CB1_m[1u].y);  // ICtCp diffuse white, equals 250.f / 10000.f
  float _1395 = exp2(log2(max(_1377 * _1382, 0.0f)) * 0.1593017578125f);
  float _1396 = exp2(log2(max(_1378 * _1382, 0.0f)) * 0.1593017578125f);
  float _1397 = exp2(log2(max(_1379 * _1382, 0.0f)) * 0.1593017578125f);
  float _1413 = exp2(log2(mad(_1395, 18.8515625f, 0.8359375f) / mad(_1395, 18.6875f, 1.0f)) * 78.84375f);
  float _1414 = exp2(log2(mad(_1396, 18.8515625f, 0.8359375f) / mad(_1396, 18.6875f, 1.0f)) * 78.84375f);

  // Intensity
  float3 _1418 = float3(_1413, _1414, exp2(log2(mad(_1397, 18.8515625f, 0.8359375f) / mad(_1397, 18.6875f, 1.0f)) * 78.84375f));
  float _1421 = max(_1379, _1378);
  float _1422 = max(_1377, _1421);
  float _1425 = asfloat(CB1_m[3u].w);
  float _1430 = asfloat(CB1_m[4u].x);  // adjusting changes contrast
  float _1431 = log2(clamp(_1377, _1421, _1425)) * _1430;
  float _1435 = asfloat(CB1_m[4u].y);
  float _1440 = asfloat(CB1_m[4u].z);
  float _1443 = asfloat(CB1_m[4u].w);  // adjusting changes contrast
  float _1445 = exp2(_1431) / mad(exp2(_1431 * _1435), _1440, _1443);
  float _1446 = _1377 / _1422;
  float _1447 = _1378 / _1422;
  float _1448 = _1379 / _1422;
  float _1451 = clamp(dp3_f32(float3(_1446, _1447, _1448), float3(0.60000002384185791015625f, 1.5f, -0.300000011920928955078125f)), 0.0f, 1.0f);
  float _1465 = exp2(log2(clamp(mad(dp2_f32(0.5f.xx, float2(_1413, _1414)), asfloat(CB1_m[7u].y), asfloat(CB1_m[7u].z)), 0.0f, 1.0f)) * asfloat(CB1_m[7u].w));
  float _1466 = 1.0f - _1465;
  float _1476 = mad(_1451, (1.0f - exp2(log2(_1445) * asfloat(CB1_m[5u].x))) + (_1465 - 1.0f), _1466);
  float _1480 = mad(_1446 - 1.0f, _1476, 1.0f);
  float _1481 = mad(_1447 - 1.0f, _1476, 1.0f);
  float _1482 = mad(_1448 - 1.0f, _1476, 1.0f);

  float _1491 = asfloat(CB1_m[6u].x);  // desaturation

  float _1504 = log2(min(mad(1.0f - _1446, _1491, _1446) * _1422, _1425)) * _1430;
  float _1505 = log2(min(mad(1.0f - _1447, _1491, _1447) * _1422, _1425)) * _1430;
  float _1506 = log2(min(mad(1.0f - _1448, _1491, _1448) * _1422, _1425)) * _1430;

#if 1
  // sdr tonemapping thats stretched to work in hdr
  // custom parameters would work differently in hdr due to the scaling, so it seems to basically just be neutral?
  float _1527 = asfloat(CB1_m[7u].x);
  float _1530 = clamp(mad(_1451, asfloat(CB1_m[6u].y) - _1527, _1527), 0.0f, 1.0f);
  float _1555 = (mad(-_1480, _1445, exp2(_1504) / mad(exp2(_1504 * _1435), _1440, _1443)) * _1530) + (_1480 * _1445);
  float _1556 = (mad(-_1481, _1445, exp2(_1505) / mad(exp2(_1505 * _1435), _1440, _1443)) * _1530) + (_1481 * _1445);
  float _1557 = (mad(-_1482, _1445, exp2(_1506) / mad(exp2(_1506 * _1435), _1440, _1443)) * _1530) + (_1482 * _1445);
#else

  float _1555 = exp2(_1504) * 2.f;
  float _1556 = exp2(_1505) * 2.f;
  float _1557 = exp2(_1506) * 2.f;

  float peak_scaling_ratio = asfloat(CB1_m[1u].x) * (1.f / _1382);
  _1555 /= (peak_scaling_ratio);
  _1556 /= (peak_scaling_ratio);
  _1557 /= (peak_scaling_ratio);

#endif

  _1555 *= _1382;
  _1556 *= _1382;
  _1557 *= _1382;

  _1555 = pow(max(0, _1555), 0.1593017578125f);
  _1556 = pow(max(0, _1556), 0.1593017578125f);
  _1557 = pow(max(0, _1557), 0.1593017578125f);
  float _1573 = exp2(log2(mad(_1555, 18.8515625f, 0.8359375f) / mad(_1555, 18.6875f, 1.0f)) * 78.84375f);
  float _1574 = exp2(log2(mad(_1556, 18.8515625f, 0.8359375f) / mad(_1556, 18.6875f, 1.0f)) * 78.84375f);
  float3 _1578 = float3(_1573, _1574, exp2(log2(mad(_1557, 18.8515625f, 0.8359375f) / mad(_1557, 18.6875f, 1.0f)) * 78.84375f));

  // ICtCp LMS -> ICtCp
  float _1579 = dp3_f32(float3(1.61370003223419189453125f, -3.323400020599365234375f, 1.70969998836517333984375f), _1578);
  float _1580 = dp3_f32(float3(4.377999782562255859375f, -4.245500087738037109375f, -0.132499992847442626953125f), _1578);
  float _1584 = _1466 * asfloat(CB1_m[6u].w);
  float3 _1589 = float3(dp2_f32(0.5f.xx, float2(_1573, _1574)), mad(_1584, dp3_f32(float3(1.61370003223419189453125f, -3.323400020599365234375f, 1.70969998836517333984375f), _1418) - _1579, _1579), mad(dp3_f32(float3(4.377999782562255859375f, -4.245500087738037109375f, -0.132499992847442626953125f), _1418) - _1580, _1584, _1580));

  // ICtCp -> ICtCp LMS
  float _1599 = exp2(log2(dp3_f32(float3(1.0f, 0.008605144917964935302734375f, 0.111035592854022979736328125f), _1589)) * 0.0126833133399486541748046875f);
  float _1600 = exp2(log2(dp3_f32(float3(1.0f, -0.008605144917964935302734375f, -0.111035592854022979736328125f), _1589)) * 0.0126833133399486541748046875f);
  float _1601 = exp2(log2(dp3_f32(float3(1.0f, 0.5600488185882568359375f, -0.3206374347209930419921875f), _1589)) * 0.0126833133399486541748046875f);
  float _1623 = 1.0f / _1382;
  float _1629 = asfloat(CB1_m[6u].z);

  // PQ -> Linear
  float3 _1633 = float3((exp2(log2(max(_1599 - 0.8359375f, 0.0f) / mad(_1599, -18.6875f, 18.8515625f)) * 6.277394771575927734375f) * _1623) * _1629, (exp2(log2(max(_1600 - 0.8359375f, 0.0f) / mad(_1600, -18.6875f, 18.8515625f)) * 6.277394771575927734375f) * _1623) * _1629, (exp2(log2(max(_1601 - 0.8359375f, 0.0f) / mad(_1601, -18.6875f, 18.8515625f)) * 6.277394771575927734375f) * _1623) * _1629);
  float3 _1637 = float3(dp3_f32(float3(2.974892139434814453125f, -2.0770013332366943359375f, 0.10213525593280792236328125f), _1633), dp3_f32(float3(-0.646511554718017578125f, 1.77281856536865234375f, -0.12628759443759918212890625f), _1633), dp3_f32(float3(0.015456843189895153045654296875f, -0.01244670711457729339599609375f, 0.99701797962188720703125f), _1633));
  float _1643 = asfloat(CB1_m[1u].x);

  // ICtCp LMS -> BT.2020
  float _1647 = (dp3_f32(float3(1.025799274444580078125f, -0.02005250938236713409423828125f, -0.005771367810666561126708984375f), _1637) * _1643);
  float _1648 = (dp3_f32(float3(-0.00223502493463456630706787109375f, 1.0045826435089111328125f, -0.00235231337137520313262939453125f), _1637) * _1643);
  float _1649 = (dp3_f32(float3(-0.005014003254473209381103515625f, -0.025293387472629547119140625f, 1.03044021129608154296875f), _1637) * _1643);

  float3 color_bt2020 = float3(_1647, _1648, _1649);

  // 2.2 EOTF Emulation
  // scales incorrectly as it assumes paper white of 250.f
  // affects saturation and hues incorrectly as it is done in BT.2020 instead of BT.709
  color_bt2020 /= _1382;
  color_bt2020 = renodx::color::srgb::Encode(color_bt2020);
  color_bt2020 = renodx::color::gamma::Decode(color_bt2020, 2.2f);
  color_bt2020 *= _1382;

  U0[CB2_m11.y][gl_GlobalInvocationID] = float4(renodx::color::pq::EncodeSafe(color_bt2020, 10000.f), 1.f);
}

[numthreads(8, 8, 1)]
void main(SPIRV_Cross_Input stage_input) {
  gl_GlobalInvocationID = stage_input.gl_GlobalInvocationID;
  comp_main();
}
